suite: test httproute
templates:
  - httproute.yaml
tests:
  - it: should create HTTPRoute when enabled
    set:
      httproute.enabled: true
    asserts:
      - isKind:
          of: HTTPRoute
      - equal:
          path: metadata.name
          value: RELEASE-NAME-learn-rust
      - equal:
          path: metadata.labels["app.kubernetes.io/part-of"]
          value: learn-rust

  - it: should not create HTTPRoute when disabled
    set:
      httproute.enabled: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should configure hostnames
    set:
      httproute.enabled: true
    asserts:
      - contains:
          path: spec.parentRefs
          content:
            name: gateway
            namespace: gateway-system
            sectionName: http

  - it: should configure hostnames
    set:
      httproute.enabled: true
    asserts:
      - contains:
          path: spec.hostnames
          content: example.local

  - it: should configure backend service
    set:
      httproute.enabled: true
    asserts:
      - equal:
          path: spec.rules[0].backendRefs[0].port
          value: 8080
